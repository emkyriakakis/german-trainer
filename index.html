<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>German Trainer â€“ Unlimited Adaptive</title>
<style>
:root {
  --bg:#f0f4f8;
  --card:#ffffff;
  --text:#222;
  --primary:#2563eb;
  --correct:#16a34a;
  --wrong:#dc2626;
  --hover:#e0ebff;
  --b1:#93c5fd;
  --b2:#facc15;
  --c1:#f87171;
}
body {margin:0; font-family:'Segoe UI',sans-serif; background:var(--bg); color:var(--text);}
header {background:var(--primary); color:white; padding:20px; text-align:center;}
header h1 {margin:0; font-size:2em;}
header p {margin:4px; font-size:1em;}
main {max-width:800px; margin:auto; padding:20px;}
.card {background:var(--card); padding:20px; border-radius:12px; box-shadow:0 8px 20px rgba(0,0,0,0.1); margin-bottom:20px; transition: transform 0.3s;}
.card:hover {transform: translateY(-5px);}
button {padding:10px 16px; background:var(--primary); color:white; border:none; border-radius:8px; cursor:pointer; margin-top:12px; transition:background 0.2s;}
button:hover {background:#1d4ed8;}
.choice {display:block; margin:6px 0; padding:10px; background:#e5e7eb; border-radius:6px; cursor:pointer; transition:background 0.2s;}
.choice:hover{background:#dbeafe;}
input {width:100%; padding:10px; margin-top:10px; font-size:16px;}
#feedback {margin-top:12px; font-weight:bold;}
.level {display:inline-block; padding:2px 8px; border-radius:8px; color:white; margin-left:8px; font-size:0.8em;}
#dailyContainer {margin-bottom:20px;}
#dailyBarContainer {background:#e5e7eb; border-radius:10px; overflow:hidden; height:14px;}
#dailyBar {height:14px; width:0%; background:var(--primary); transition:width .3s ease;}
</style>
</head>
<body>
<header>
  <h1>ðŸ‡©ðŸ‡ª German Trainer</h1>
  <p>Unlimited Adaptive Grammar â€¢ Vocabulary â€¢ Articles â€¢ Writing</p>
</header>
<main>
  <div id="dailyContainer" class="card">
    <h3>ðŸ”¥ Daily Progress</h3>
    <div id="dailyBarContainer"><div id="dailyBar"></div></div>
    <p id="dailyText"></p>
  </div>
  <div class="card">
    <h3>ðŸ“Š Topic Progress</h3>
    <div id="grammarBars"></div>
  </div>
  <div class="card">
    <h2 id="meta"></h2>
    <div id="content"></div>
    <div id="feedback"></div>
    <button id="nextBtn">Next</button>
  </div>
</main>

<script>
/* ================= STATE ================= */
let current=null, enterMode="check";
let stats=JSON.parse(localStorage.getItem("stats"))||{};
let daily=JSON.parse(localStorage.getItem("daily"))||{date:new Date().toISOString().split("T")[0], done:0, streak:0, lastDate:null};

/* reset daily */
if(daily.date!==new Date().toISOString().split("T")[0]){
  daily.streak=(daily.lastDate===new Date(Date.now()-86400000).toISOString().split("T")[0])? daily.streak+1:1;
  daily.lastDate=daily.date;
  daily.date=new Date().toISOString().split("T")[0]; daily.done=0;
}

/* ================= UTILS ================= */
function shuffle(a){return a.sort(()=>Math.random()-0.5);}
function saveAll(){localStorage.setItem("stats",JSON.stringify(stats)); localStorage.setItem("daily",JSON.stringify(daily));}
function topicLevel(topic){const s=stats[topic]; if(!s) return "B1"; const p=s.correct/(s.done||1); if(p<0.6)return "B1"; if(p<0.8)return "B2"; return "C1";}

/* ================= DATA GENERATION ================= */
const verbs=["lernen","arbeiten","kommen","sehen","haben","sein","wollen"];
const nouns=["Haus","Arbeit","Zeit","Freund","Buch","Schule"];
const adjectives=["neu","alt","schnell","langsam","groÃŸ","klein"];
const subjects=["Ich","Du","Er","Sie","Wir","Ihr","Sie"];
const articlesList=[{word:"Apfel",art:"der"},{word:"Banane",art:"die"},{word:"MÃ¤dchen",art:"das"},{word:"Hund",art:"der"},{word:"Katze",art:"die"}];

/* generate grammar sentence dynamically */
function generateGrammar(){
  const lvl=["B1","B2","C1"][Math.floor(Math.random()*3)];
  const subj=subjects[Math.floor(Math.random()*subjects.length)];
  const verb=verbs[Math.floor(Math.random()*verbs.length)];
  const adj=adjectives[Math.floor(Math.random()*adjectives.length)];
  const noun=nouns[Math.floor(Math.random()*nouns.length)];
  const type=Math.random()<0.5?"weil":"obwohl";
  const q=`${subj} ___ ${verb} ${noun}.`;
  const a=(Math.random()<0.5)?type:"wÃ¼rde";
  const choices=shuffle([a,"hÃ¤tte","wÃ¤re"]);
  return {id:"g-"+Date.now()+Math.random(),lvl,type,topic:"Grammar",q,a,choices};
}

/* generate writing prompt dynamically */
function generateWriting(){
  const subj=subjects[Math.floor(Math.random()*subjects.length)];
  const verb=verbs[Math.floor(Math.random()*verbs.length)];
  const noun=nouns[Math.floor(Math.random()*nouns.length)];
  const type=Math.random()<0.5?"weil":"obwohl";
  const prompt=`Schreibe einen Satz mit â€ž${type}â€œ Ã¼ber ${noun}.`;
  const model=`${subj} lernt Deutsch, ${type} er ${verb} ${noun}.`;
  const choices=shuffle([model,`${subj} lernt Deutsch, weil er ${verb} ${noun}.`,`${subj} lernt Deutsch, obwohl er ${verb} ${noun}.`]);
  return {id:"w-"+Date.now()+Math.random(),prompt,model,choices,topic:"Writing",lvl:"B1"};
}

/* generate vocabulary dynamically */
function generateVocab(){
  const german=verbs[Math.floor(Math.random()*verbs.length)];
  const english=["learn","work","come","see","have","be","want"][Math.floor(Math.random()*7)];
  return {id:"v-"+Date.now()+Math.random(),pairs:[[german,english]],topic:"Vocabulary"};
}

/* generate article exercise dynamically */
function generateArticle(){
  const item=articlesList[Math.floor(Math.random()*articlesList.length)];
  return {id:"a-"+Date.now()+Math.random(),word:item.word,article:item.art,topic:"Articles"};
}

/* ================= EXERCISE FLOW ================= */
function nextExercise(){
  enterMode="check";
  document.getElementById("feedback").innerHTML="";
  const r=Math.random();
  if(r<0.25) current=generateGrammar();
  else if(r<0.5) current=generateVocab();
  else if(r<0.75) current=generateWriting();
  else current=generateArticle();
  renderExercise();
}

function renderExercise(){
  const meta=document.getElementById("meta");
  const content=document.getElementById("content");
  if(current.topic==="Grammar" || current.topic==="Writing") meta.innerHTML=`${current.lvl} â€¢ ${current.topic}`;
  else meta.innerHTML=current.topic;
  
  if(current.topic==="Vocabulary"){ 
    content.innerHTML=current.pairs.map(p=>`<p>${p[0]} â†’ ? <b>${p[1]}</b></p>`).join("");
  } else if(current.topic==="Grammar" || current.topic==="Writing"){ 
    content.innerHTML=(current.q||current.prompt) + current.choices.map(c=>`<div class="choice" onclick="checkChoice('${c}')">${c}</div>`).join("");
  } else if(current.topic==="Articles"){
    content.innerHTML=`<p>WÃ¤hle den richtigen Artikel fÃ¼r <b>${current.word}</b>:</p>${["der","die","das"].map(a=>`<button onclick="checkArticle('${a}')">${a}</button>`).join("")}`;
  }
}

/* ================= CHECK ================= */
function checkChoice(choice){
  const fb=document.getElementById("feedback");
  const correct=(current.a||current.model)===choice;
  fb.style.color=correct?"green":"red";
  fb.innerHTML=correct?"âœ” Correct!":`âœ˜ Correct: <b>${current.a||current.model}</b>`;
  stats[current.id]=stats[current.id]||{done:0,correct:0,wrong:0};
  stats[current.id].done++; correct?stats[current.id].correct++:stats[current.id].wrong++;
  daily.done++; saveAll(); renderDaily(); renderGrammarBars();
}

function checkArticle(article){
  const fb=document.getElementById("feedback");
  const ok=article===current.article;
  fb.style.color=ok?"green":"red";
  fb.innerHTML=ok?"âœ” Correct!":`âœ˜ Correct: <b>${current.article}</b>`;
  stats[current.word]=stats[current.word]||{done:0,correct:0,wrong:0};
  stats[current.word].done++; ok?stats[current.word].correct++:stats[current.word].wrong++;
  daily.done++; saveAll(); renderDaily();
}

/* ================= DASHBOARD ================= */
function renderGrammarBars(){
  const box=document.getElementById("grammarBars"); box.innerHTML="";
  for(let t in stats){
    const s=stats[t]; const p=Math.round(s.correct/(s.done||1)*100);
    box.innerHTML+=`<div>${t} (${p}%)</div><div class="progress"><div style="width:${p}%"></div></div>`;
  }
}
function renderDaily(){
  const pct=Math.min(100,Math.round(daily.done/20*100));
  document.getElementById("dailyBar").style.width=pct+"%";
  document.getElementById("dailyText").innerText=`${daily.done} exercises â€¢ ðŸ”¥ ${daily.streak} day streak`;
}

/* ================= ENTER/BTN ================= */
document.getElementById("nextBtn").addEventListener("click",()=>{nextExercise();});

/* ================= START ================= */
renderDaily(); renderGrammarBars(); nextExercise();
</script>
</body>
</html>
