<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>German Trainer ‚Äì Daily 20 Exercises</title>
<style>
:root {
  --bg:#f0f4f8; --card:#ffffff; --text:#222; --primary:#2563eb;
  --correct:#16a34a; --wrong:#dc2626; --grammar:#3b82f6; --writing:#8b5cf6;
  --vocab:#10b981; --articles:#f97316; --reading:#14b8a6;
}
body{margin:0;font-family:'Segoe UI',sans-serif;background:var(--bg);color:var(--text);}
header{background:linear-gradient(90deg,#2563eb,#3b82f6);color:white;padding:20px;text-align:center;box-shadow:0 4px 8px rgba(0,0,0,0.15);}
header h1{margin:0;font-size:2em;} header p{margin:4px;font-size:1em;}
main{max-width:900px;margin:auto;padding:20px;}
.card{background:var(--card);padding:20px;border-radius:16px;box-shadow:0 8px 20px rgba(0,0,0,0.1);margin-bottom:20px;transition:transform .3s, box-shadow .3s;}
.card:hover{transform:translateY(-5px);box-shadow:0 12px 25px rgba(0,0,0,0.2);}
button{padding:12px 18px;background:var(--primary);color:white;border:none;border-radius:10px;cursor:pointer;margin-top:12px;font-weight:bold;transition:background .3s, transform .2s;}
button:hover{background:#1d4ed8;transform:scale(1.05);}
.choice{display:block;margin:10px 0;padding:12px;background:#e5e7eb;border-radius:8px;cursor:pointer;transition: all .2s;}
.choice:hover{background:#dbeafe; transform:scale(1.03);}
input{width:100%;padding:10px;margin-top:10px;font-size:16px;border-radius:6px;border:1px solid #ccc;}
#feedback{margin-top:12px;font-weight:bold;font-size:1.1em;transition:all .3s;}
#dailyBarContainer{background:#e5e7eb;border-radius:10px;overflow:hidden;height:16px;margin-top:8px;}
#dailyBar{height:16px;width:0%;background:var(--primary);transition:width .4s;}
.level{display:inline-block;padding:2px 10px;border-radius:12px;color:white;margin-left:8px;font-size:0.85em;}
.topic-icon{margin-right:8px;}
.correct-choice{background:var(--correct)!important;color:white;transform:scale(1.05);}
.wrong-choice{background:var(--wrong)!important;color:white;transform:scale(1.05);}
</style>
</head>
<body>
<header>
<h1>üá©üá™ German Trainer</h1>
<p>Grammar ‚Ä¢ Vocabulary ‚Ä¢ Articles ‚Ä¢ Writing ‚Ä¢ Reading Comprehension</p>
</header>
<main>
<div id="dailyCard" class="card">
<h3>üî• Daily Progress</h3>
<div id="dailyBarContainer"><div id="dailyBar"></div></div>
<p id="dailyText"></p>
</div>
<div class="card">
<h3>üìä Topic Progress</h3>
<div id="grammarBars"></div>
</div>
<div class="card">
<h2 id="meta"></h2>
<div id="content"></div>
<div id="feedback"></div>
<button id="nextBtn">Next</button>
</div>
<script>
/* ================= STATE ================= */
let current=null, consecutiveCorrect=0;
let stats=JSON.parse(localStorage.getItem("stats"))||{};
let daily=JSON.parse(localStorage.getItem("daily"))||{date:new Date().toISOString().split("T")[0], done:0, streak:0, lastDate:null, todayExercises:[]};
const todayKey=new Date().toISOString().split("T")[0];
if(daily.date!==todayKey){
  daily.streak=(daily.lastDate===new Date(Date.now()-86400000).toISOString().split("T")[0])? daily.streak+1:1;
  daily.lastDate=daily.date; daily.date=todayKey; daily.done=0; daily.todayExercises=[];
}

/* ================= DATA ================= */
const verbs=["spielen","lernen","gehen","lesen","schreiben","arbeiten","reisen"];
const nouns=["Haus","Schule","Hund","Katze","Buch","Auto","Stra√üe","Baum"];
const people=["Anna","Max","Lisa","Tom"];
const grammarTemplates=[{template:"{person} {verb} gern {noun}, weil {reason}.",lvl:"B1"},
{template:"Wenn {person} Zeit {verb2}, {verb3} er {noun}.",lvl:"B2"},
{template:"Er tut so, als ob er {verb} {noun}.",lvl:"C1"}];
const writingTemplates=[{template:"Schreibe einen Satz mit '{conjunction}' √ºber {noun}.",lvl:"B1"},
{template:"Schreibe einen Satz mit Konjunktiv II √ºber {noun}.",lvl:"C1"}];
const vocabList=[["arbeiten","to work"],["lernen","to learn"],["Haus","house"],["Katze","cat"],["Buch","book"],["essen","to eat"],["Trinken","drink"],["Auto","car"],["Stra√üe","street"],["Baum","tree"]];
const articlesList=[{word:"Apfel",art:"der"},{word:"Banane",art:"die"},{word:"M√§dchen",art:"das"},{word:"Hund",art:"der"},{word:"Katze",art:"die"},{word:"Auto",art:"das"}];
const readingComprehensions=[
{text:`Anna geht morgens in die Schule. Sie liest ein Buch im Unterricht und spricht danach mit ihren Freunden auf dem Pausenhof.`,
questions:[
{q:"Wo geht Anna morgens hin?",options:["Schule","Park","Zuhause"],answer:"Schule"},
{q:"Was macht Anna im Unterricht?",options:["liest ein Buch","spielt Fu√üball","isst"],answer:"liest ein Buch"},
{q:"Mit wem spricht sie danach?",options:["ihren Freunden","ihren Lehrern","ihrem Hund"],answer:"ihren Freunden"}
]},
{text:`Max arbeitet im B√ºro. Er telefoniert viel und schreibt E-Mails. Mittags geht er kurz spazieren, um frische Luft zu schnappen.`,
questions:[
{q:"Wo arbeitet Max?",options:["im B√ºro","in der Schule","im Park"],answer:"im B√ºro"},
{q:"Was macht er mittags?",options:["spazieren gehen","essen","lesen"],answer:"spazieren gehen"},
{q:"Was macht Max beruflich?",options:["telefoniert und schreibt E-Mails","kocht","spielt"],answer:"telefoniert und schreibt E-Mails"}
]}
];

/* ================= UTILS ================= */
function shuffle(a){return a.sort(()=>Math.random()-0.5);}
function saveAll(){localStorage.setItem("stats",JSON.stringify(stats));localStorage.setItem("daily",JSON.stringify(daily));}
function getDifficulty(){if(consecutiveCorrect>=5) return "C1"; if(consecutiveCorrect>=3) return "B2"; return "B1";}
function clearChoices(){document.querySelectorAll(".choice").forEach(c=>c.style.pointerEvents="auto");document.querySelectorAll("button").forEach(b=>b.disabled=false);}
function generateUniqueId(prefix){return prefix+"-"+Date.now()+Math.random();}

/* ================= EXERCISE GENERATORS ================= */
function generateGrammar(){
  const lvl=getDifficulty();
  const t=grammarTemplates.filter(g=>g.lvl===lvl)[Math.floor(Math.random()*grammarTemplates.length)];
  const person=people[Math.floor(Math.random()*people.length)];
  const verb=verbs[Math.floor(Math.random()*verbs.length)];
  const verb2=verbs[Math.floor(Math.random()*verbs.length)];
  const verb3=verbs[Math.floor(Math.random()*verbs.length)];
  const noun=nouns[Math.floor(Math.random()*nouns.length)];
  const reason="es regnet";
  const q=t.template.replace("{person}",person).replace("{verb}",verb).replace("{verb2}",verb2).replace("{verb3}",verb3).replace("{noun}",noun).replace("{reason}",reason);
  const options=shuffle([verb,verb2,verb3,verbs[Math.floor(Math.random()*verbs.length)],verbs[Math.floor(Math.random()*verbs.length)]]).slice(0,getDifficulty()==="C1"?5:3);
  return {id:generateUniqueId("g"),topic:"Grammar",lvl:lvl,q:q,options:options,answer:verb};
}

function generateWriting(){
  const lvl=getDifficulty();
  const t=writingTemplates[Math.floor(Math.random()*writingTemplates.length)];
  const noun=nouns[Math.floor(Math.random()*nouns.length)];
  const conjunction=shuffle(["weil","obwohl","damit"])[0];
  const q=t.template.replace("{conjunction}",conjunction).replace("{noun}",noun);
  const answer=`Ich lerne Deutsch ${conjunction} ich ${noun} habe.`;
  const options=shuffle([answer,"Ich gehe zur Schule.","Ich spiele Fu√üball."]);
  return {id:generateUniqueId("w"),topic:"Writing",lvl:lvl,prompt:q,choices:options,answer:answer};
}

function generateVocab(){ const v=shuffle(vocabList).slice(0,5); return {id:generateUniqueId("v"),pairs:v,topic:"Vocabulary"};}
function generateArticle(){ const a=articlesList[Math.floor(Math.random()*articlesList.length)]; return {id:generateUniqueId("a"),word:a.word,article:a.art,topic:"Articles"};}
function generateReading(){return readingComprehensionExercise();}

/* ================= READING COMPREHENSION ================= */
let currentReading=null; let readingIndex=0;
function readingComprehensionExercise(){
  currentReading=readingComprehensions[Math.floor(Math.random()*readingComprehensions.length)];
  readingIndex=0; return {id:generateUniqueId("r"),topic:"Reading"};
}
function renderReadingQuestion(){
  const meta=document.getElementById("meta"); const content=document.getElementById("content"); const fb=document.getElementById("feedback");
  fb.innerHTML="";
  meta.innerHTML=`<span class="topic-icon" style="color:var(--reading)">‚óè</span>Reading Comprehension`;
  const question=currentReading.questions[readingIndex];
  content.innerHTML=`<p>${currentReading.text}</p>`+
    `<p><b>Frage ${readingIndex+1}:</b> ${question.q}</p>`+
    question.options.map(o=>`<div class="choice" onclick="checkReading('${o}',this)">${o}</div>`).join("");
}
function checkReading(choice,el){
  document.querySelectorAll(".choice").forEach(c=>c.style.pointerEvents="none");
  const question=currentReading.questions[readingIndex];
  const fb=document.getElementById("feedback"); const correct=choice===question.answer;
  fb.style.color=correct?"green":"red"; fb.innerHTML=correct?"‚úî Correct!":`‚úò Correct: <b>${question.answer}</b>`;
  correct?el.classList.add("correct-choice"):el.classList.add("wrong-choice");
  stats[`r-${readingIndex}`]=stats[`r-${readingIndex}`]||{done:0,correct:0,wrong:0};
  stats[`r-${readingIndex}`].done++; correct?stats[`r-${readingIndex}`].correct++:stats[`r-${readingIndex}`].wrong++;
  daily.done++; saveAll(); renderDaily(); renderGrammarBars();
  readingIndex++; setTimeout(()=>{if(readingIndex<currentReading.questions.length){renderReadingQuestion();}else{nextExercise();}},1000);
}

/* ================= DAILY 20 GENERATOR ================= */
const DAILY_GOAL = 20;
function generateDailyExercises() {
  daily.todayExercises = [];
  const types = ["Grammar","Writing","Vocabulary","Articles","Reading"];
  let attempts = 0;
  while(daily.todayExercises.length < DAILY_GOAL && attempts < 200) {
    attempts++;
    const type = types[Math.floor(Math.random()*types.length)];
    let exercise;
    if(type==="Grammar") exercise = generateGrammar();
    else if(type==="Writing") exercise = generateWriting();
    else if(type==="Vocabulary") exercise = generateVocab();
    else if(type==="Articles") exercise = generateArticle();
    else if(type==="Reading") exercise = generateReading();
    if(!daily.todayExercises.some(e=>e.id===exercise.id)){
      daily.todayExercises.push(exercise);
    }
  }
  daily.done=0; saveAll(); dailyIndex=0;
}

/* ================= NEXT EXERCISE ================= */
let dailyIndex=0;
function nextExercise(){
  clearChoices();
  if(!daily.todayExercises || daily.todayExercises.length===0){ generateDailyExercises(); dailyIndex=0; }
  if(dailyIndex>=daily.todayExercises.length){
    document.getElementById("meta").innerText="üéâ Daily exercises completed!";
    document.getElementById("content").innerHTML="";
    document.getElementById("feedback").innerHTML="";
    return;
  }
  current=daily.todayExercises[dailyIndex]; dailyIndex++;
  renderExercise();
}

/* ================= RENDER ================= */
function renderExercise(){
  const meta=document.getElementById("meta"); const content=document.getElementById("content"); const fb=document.getElementById("feedback");
  fb.innerHTML="";
  const topicColor={Grammar:"var(--grammar)",Writing:"var(--writing)",Vocabulary:"var(--vocab)",Articles:"var(--articles)",Reading:"var(--reading)"}[current.topic]||"var(--primary)";
  meta.innerHTML=`<span class="topic-icon" style="color:${topicColor}">‚óè</span>${current.topic}`;
  if(current.topic==="Grammar"||current.topic==="Writing"){
    let choices=current.options||current.choices;
    content.innerHTML=`<p>${current.q||current.prompt}</p>`+choices.map(o=>`<div class="choice" onclick="checkChoice('${o}',this)">${o}</div>`).join("");
  }else if(current.topic==="Vocabulary"){
    content.innerHTML=current.pairs.map(p=>`<p>${p[0]} ‚Üí ? <b>${p[1]}</b></p>`).join(""); consecutiveCorrect++; daily.done++; saveAll(); renderDaily();
  }else if(current.topic==="Articles"){
    content.innerHTML=`<p>W√§hle den richtigen Artikel f√ºr <b>${current.word}</b>:</p>`+["der","die","das"].map(a=>`<button onclick="checkArticle('${a}',this)">${a}</button>`).join("");
  }else if(current.topic==="Reading"){ renderReadingQuestion(); }
}

/* ================= CHECK ================= */
function checkChoice(choice,el){
  document.querySelectorAll(".choice").forEach(c=>c.style.pointerEvents="none");
  const fb=document.getElementById("feedback"); const correct=choice===current.answer;
  fb.style.color=correct?"green":"red"; fb.innerHTML=correct?"‚úî Correct!":`‚úò Correct: <b>${current.answer}</b>`;
  correct?el.classList.add("correct-choice"):el.classList.add("wrong-choice");
  stats[current.id]=stats[current.id]||{done:0,correct:0,wrong:0}; stats[current.id].done++; correct?stats[current.id].correct++:stats[current.id].wrong++;
  daily.done++; saveAll(); renderDaily(); renderGrammarBars();
  consecutiveCorrect=correct?consecutiveCorrect+1:0;
}
function checkArticle(article,btn){
  document.querySelectorAll("button").forEach(b=>b.disabled=true);
  const fb=document.getElementById("feedback"); const ok=article===current.article;
  fb.style.color=ok?"green":"red"; fb.innerHTML=ok?"‚úî Correct!":`‚úò Correct: <b>${current.article}</b>`;
  ok?btn.classList.add("correct-choice"):btn.classList.add("wrong-choice");
  stats[current.word]=stats[current.word]||{done:0,correct:0,wrong:0}; stats[current.word].done++; ok?stats[current.word].correct++:stats[current.word].wrong++;
  daily.done++; saveAll(); renderDaily(); consecutiveCorrect=ok?consecutiveCorrect+1:0;
}

/* ================= DASHBOARD ================= */
function renderGrammarBars(){
  const box=document.getElementById("grammarBars"); box.innerHTML="";
  const topicStats={};
  for(let key in stats){
    const s=stats[key];
    const topic=key.startsWith("g-")?"Grammar":key.startsWith("w-")?"Writing":key.startsWith("v-")?"Vocabulary":key.startsWith("a-")?"Articles":key.startsWith("r-")?"Reading":key;
    if(!topicStats[topic]) topicStats[topic]={done:0,correct:0};
    topicStats[topic].done+=s.done||0; topicStats[topic].correct+=s.correct||0;
  }
  for(let t in topicStats){
    const s=topicStats[t]; const p=s.done?s.correct/s.done*100:0;
    let color={Grammar:"var(--grammar)",Writing:"var(--writing)",Vocabulary:"var(--vocab)",Articles:"var(--articles)",Reading:"var(--reading)"}[t]||"var(--primary)";
    box.innerHTML+=`<div>${t} (${Math.round(p)}%)</div><div class="progress" style="background:#e5e7eb;border-radius:10px;height:14px;margin-bottom:8px;"><div style="width:${p}%;height:14px;background:${color};border-radius:10px;"></div></div>`;
  }
}
function renderDaily(){
  const pct=Math.min(100,Math.round(daily.done/DAILY_GOAL*100));
  document.getElementById("dailyBar").style.width=pct+"%";
  document.getElementById("dailyText").innerText=`${daily.done}/${DAILY_GOAL} exercises ‚Ä¢ üî• ${daily.streak} day streak`;
}

/* ================= EVENTS ================= */
document.getElementById("nextBtn").addEventListener("click",()=>{nextExercise();});

/* ================= START ================= */
if(!daily.todayExercises || daily.todayExercises.length===0){ generateDailyExercises(); dailyIndex=0; }
renderGrammarBars(); renderDaily(); nextExercise();
</script>
</main>
</body>
</html>
