<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>German Trainer â€“ No Repeats</title>

<style>
:root {
  --bg:#f4f6f8;
  --card:#ffffff;
  --text:#222;
  --primary:#2563eb;
  --correct:#16a34a;
  --wrong:#dc2626;
}

body {
  margin:0;
  font-family:Arial, sans-serif;
  background:var(--bg);
  color:var(--text);
}

header {
  background:var(--primary);
  color:white;
  padding:16px;
  text-align:center;
}

main {
  max-width:600px;
  margin:auto;
  padding:20px;
}

.card {
  background:var(--card);
  padding:20px;
  border-radius:12px;
  box-shadow:0 6px 15px rgba(0,0,0,0.1);
  animation:slideIn .4s ease;
}

input {
  width:100%;
  padding:10px;
  margin-top:10px;
  font-size:16px;
}

button {
  margin-top:12px;
  padding:10px 16px;
  font-size:16px;
  background:var(--primary);
  color:white;
  border:none;
  border-radius:6px;
  cursor:pointer;
}

#feedback {
  margin-top:12px;
  font-weight:bold;
}

.progress {
  background:#e5e7eb;
  border-radius:10px;
  overflow:hidden;
  margin-bottom:12px;
}

.progress > div {
  height:12px;
  width:0%;
  background:var(--correct);
  transition:width .3s ease;
}

@keyframes slideIn {
  from {opacity:0; transform:translateX(20px);}
  to {opacity:1; transform:translateX(0);}
}
</style>
</head>

<body>

<header>
  <h1>ðŸ‡©ðŸ‡ª German Trainer</h1>
  <p>B1 â†’ C1 â€¢ No Repeats</p>
</header>

<main>
  <div class="progress"><div id="bar"></div></div>
  <div class="card">
    <h2 id="meta"></h2>
    <p id="question"></p>

    <input id="answer" placeholder="Type answer and press Enter">
    <button onclick="handleAction()" id="actionBtn">Check</button>
    <div id="feedback"></div>
  </div>
</main>

<script>
/* ---------- DATE HELPERS ---------- */
const today = () => new Date().toISOString().slice(0,10);
const week = () => {
  const d = new Date();
  const onejan = new Date(d.getFullYear(),0,1);
  return Math.ceil((((d - onejan) / 86400000) + onejan.getDay()+1)/7);
};

/* ---------- STORAGE ---------- */
let seenToday = JSON.parse(localStorage.getItem("seenToday")) || {};
let seenWeek = JSON.parse(localStorage.getItem("seenWeek")) || {};
let doneToday = JSON.parse(localStorage.getItem("doneToday")) || 0;

if (seenToday.date !== today()) {
  seenToday = { date: today(), ids: [] };
  doneToday = 0;
}

if (seenWeek.week !== week()) {
  seenWeek = { week: week(), ids: [] };
}

function saveProgress() {
  localStorage.setItem("seenToday", JSON.stringify(seenToday));
  localStorage.setItem("seenWeek", JSON.stringify(seenWeek));
  localStorage.setItem("doneToday", doneToday);
}

/* ---------- POOLS ---------- */
const grammar = [
  {id:"g1",lvl:"B1",q:"Ich ___ mehr Deutsch lernen.",a:"mÃ¶chte"},
  {id:"g2",lvl:"B1",q:"Er bleibt zu Hause, ___ es regnet.",a:"weil"},
  {id:"g3",lvl:"B2",q:"Wenn ich Zeit ___, wÃ¼rde ich reisen.",a:"hÃ¤tte"},
  {id:"g4",lvl:"C1",q:"Kaum ___ er da, begann es.",a:"war"},
];

const vocab = [
  {id:"v1",lvl:"B1",q:"arbeiten",a:"work"},
  {id:"v2",lvl:"B1",q:"der Alltag",a:"daily life"},
  {id:"v3",lvl:"B2",q:"vermeiden",a:"avoid"},
  {id:"v4",lvl:"C1",q:"die Voraussetzung",a:"prerequisite"},
];

/* ---------- GENERATOR ---------- */
let current = null;
let mode = "check";

function generateExercise() {
  const pool = [...grammar, ...vocab]
    .filter(x =>
      !seenToday.ids.includes(x.id) &&
      !seenWeek.ids.includes(x.id)
    );

  if (pool.length === 0) {
    seenWeek.ids = [];
    return generateExercise();
  }

  return pool[Math.floor(Math.random()*pool.length)];
}

/* ---------- LOAD ---------- */
function loadExercise() {
  current = generateExercise();
  document.getElementById("meta").innerText =
    `${current.lvl} â€¢ ${current.id.startsWith("g") ? "Grammar" : "Vocabulary"}`;
  document.getElementById("question").innerHTML =
    current.id.startsWith("g")
      ? current.q
      : `What is the English meaning of <b>${current.q}</b>?`;

  document.getElementById("answer").value = "";
  document.getElementById("feedback").innerText = "";
  document.getElementById("actionBtn").innerText = "Check";
  mode = "check";
}

/* ---------- CHECK ---------- */
function handleAction() {
  if (mode === "check") {
    const user = document.getElementById("answer").value.trim().toLowerCase();
    const correct = current.a.toLowerCase();
    const fb = document.getElementById("feedback");

    if (user === correct) {
      fb.style.color = "var(--correct)";
      fb.innerText = "âœ” Correct!";
    } else {
      fb.style.color = "var(--wrong)";
      fb.innerHTML = `âœ˜ Correct answer: <b>${current.a}</b>`;
    }

    seenToday.ids.push(current.id);
    seenWeek.ids.push(current.id);
    doneToday++;
    saveProgress();
    updateBar();

    document.getElementById("actionBtn").innerText = "Next";
    mode = "next";
  } else {
    loadExercise();
  }
}

/* ---------- PROGRESS BAR ---------- */
function updateBar() {
  const dailyTarget = 20;
  const pct = Math.min(100, (doneToday/dailyTarget)*100);
  document.getElementById("bar").style.width = pct + "%";
}

/* ---------- ENTER ---------- */
document.getElementById("answer").addEventListener("keydown", e => {
  if (e.key === "Enter") handleAction();
});

/* ---------- START ---------- */
updateBar();
loadExercise();
</script>

</body>
</html>
