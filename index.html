<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>German Trainer â€“ Serious Version</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{font-family:system-ui;background:#f3f4f6;margin:0}
header{background:#1e40af;color:white;padding:20px;text-align:center}
main{max-width:900px;margin:auto;padding:20px}
.card{background:white;padding:20px;border-radius:16px;margin-bottom:20px;box-shadow:0 10px 25px rgba(0,0,0,.1)}
h2,h3{margin-top:0}
.choice{padding:12px;margin:8px 0;background:#e5e7eb;border-radius:10px;cursor:pointer}
.choice:hover{background:#dbeafe}
.correct{background:#16a34a;color:white}
.wrong{background:#dc2626;color:white}
button{padding:12px 20px;border:none;border-radius:10px;background:#2563eb;color:white;font-weight:600;cursor:pointer}
.progress{background:#e5e7eb;border-radius:10px;height:14px;margin-bottom:10px}
.progress div{height:14px;border-radius:10px;background:#16a34a}
.badge{display:inline-block;padding:4px 10px;border-radius:12px;background:#e0e7ff;color:#1e40af;font-size:12px;margin-right:6px}
</style>
</head>
<body>
<header>
<h1>ðŸ‡©ðŸ‡ª German Trainer</h1>
<p>Correct German â€¢ No Repetition â€¢ Adaptive Difficulty</p>
</header>
<main>

<div class="card">
<h3>ðŸ“… Daily Progress</h3>
<p><span id="dailyDone">0</span> / 20 exercises</p>
<div class="progress"><div id="dailyBar" style="width:0%"></div></div>
</div>

<div class="card">
<h3>ðŸ“Š Topic Progress</h3>
<div id="progressBox"></div>
</div>

<div class="card">
<span class="badge" id="level">B1</span>
<h2 id="question"></h2>
<div id="choices"></div>
<div id="feedback"></div>
<button id="nextBtn">Next</button>
</div>

</main>
<script>
/* ===== CORE STATE ===== */
let checked=false;
let current=null;
let dailyDone=Number(localStorage.getItem('dailyDone'))||0;
let stats=JSON.parse(localStorage.getItem('stats'))||{
  Articles:{done:0,correct:0}
};
let usedIds=JSON.parse(localStorage.getItem('usedIds'))||[];

/* ===== RESET DAILY ===== */
const today=new Date().toDateString();
if(localStorage.getItem('lastDate')!==today){
  dailyDone=0;
  usedIds=[];
  localStorage.setItem('lastDate',today);
  localStorage.setItem('usedIds','[]');
}

/* ===== LINGUISTIC DATA ===== */
const nouns=[
 {w:'Hund',g:'m',akk:'den',dat:'dem'},
 {w:'Apfel',g:'m',akk:'den',dat:'dem'},
 {w:'Mann',g:'m',akk:'den',dat:'dem'},
 {w:'Frau',g:'f',akk:'die',dat:'der'},
 {w:'Katze',g:'f',akk:'die',dat:'der'},
 {w:'Kind',g:'n',akk:'das',dat:'dem'}
];

const subjects=[
 {w:'Der Mann',g:'m'},
 {w:'Die Frau',g:'f'}
];

const verbsAkk=[
 {v:'sieht',case:'akk'},
 {v:'kauft',case:'akk'},
 {v:'mag',case:'akk'}
];

const verbsDat=[
 {v:'hilft',case:'dat'},
 {v:'dankt',case:'dat'}
];

const places=['im Park','zu Hause','im Supermarkt'];

/* ===== HELPERS ===== */
function uid(s){return btoa(s).slice(0,20)}
function shuffle(a){return a.sort(()=>Math.random()-0.5)}

/* ===== GENERATOR (CORRECT GERMAN ONLY) ===== */
function generateArticleExercise(){
 let ex,id,tries=0;
 do{
  tries++;
  const subj=subjects[Math.floor(Math.random()*subjects.length)];
  const isDat=Math.random()>0.5;
  const verb=(isDat?verbsDat:verbsAkk)[Math.floor(Math.random()*(isDat?verbsDat:verbsAkk).length)];
  const noun=nouns[Math.floor(Math.random()*nouns.length)];
  const place=places[Math.floor(Math.random()*places.length)];
  const correct=isDat?noun.dat:noun.akk;

  ex={
    topic:'Articles',
    q:`${subj.w} ${verb.v} ___ ${noun.w} ${place}. (${isDat?'Dativ':'Akkusativ'})`,
    options:shuffle(['der','die','das','den','dem']),
    a:correct
  };
  id=uid(ex.q+ex.a);
 }while(usedIds.includes(id)&&tries<100);
 usedIds.push(id);
 localStorage.setItem('usedIds',JSON.stringify(usedIds));
 ex.id=id;
 return ex;
}

/* ===== RENDER ===== */
function render(){
 checked=false;
 current=generateArticleExercise();
 document.getElementById('question').innerText=current.q;
 document.getElementById('feedback').innerHTML='';
 document.getElementById('choices').innerHTML=current.options.map(o=>
   `<div class="choice" onclick="select('${o}',this)">${o}</div>`).join('');
}

/* ===== CHECK ===== */
function select(val,el){
 if(checked) return;
 checked=true;
 const ok=val===current.a;
 el.classList.add(ok?'correct':'wrong');
 document.getElementById('feedback').innerHTML=ok?
  'âœ” Richtig':`âœ˜ Richtig ist: <b>${current.a}</b>`;
 stats[current.topic].done++;
 if(ok) stats[current.topic].correct++;
 dailyDone++;
 localStorage.setItem('dailyDone',dailyDone);
 localStorage.setItem('stats',JSON.stringify(stats));
 updateUI();
}

/* ===== UI ===== */
function updateUI(){
 document.getElementById('dailyDone').innerText=dailyDone;
 document.getElementById('dailyBar').style.width=Math.min(100,dailyDone/20*100)+'%';
 const box=document.getElementById('progressBox');
 box.innerHTML='';
 for(let t in stats){
  const s=stats[t];
  const p=s.done?Math.round(s.correct/s.done*100):0;
  box.innerHTML+=`<div>${t} (${p}%)</div><div class="progress"><div style="width:${p}%"></div></div>`;
 }
}

/* ===== ENTER / NEXT ===== */
document.addEventListener('keydown',e=>{if(e.key==='Enter'&&checked)render()});
document.getElementById('nextBtn').onclick=render;

/* ===== INIT ===== */
updateUI();
render();
</script>
</body>
</html>
