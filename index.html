<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>German Trainer ‚Äì Grammar Progress</title>

<style>
:root {
  --bg:#f4f6f8;
  --card:#ffffff;
  --text:#222;
  --primary:#2563eb;
  --correct:#16a34a;
  --wrong:#dc2626;
}

body {
  margin:0;
  font-family:Arial, sans-serif;
  background:var(--bg);
  color:var(--text);
}

header {
  background:var(--primary);
  color:white;
  padding:16px;
  text-align:center;
}

main {
  max-width:750px;
  margin:auto;
  padding:20px;
}

.card {
  background:var(--card);
  padding:20px;
  border-radius:12px;
  box-shadow:0 6px 15px rgba(0,0,0,0.1);
  animation:slideIn .4s ease;
  margin-bottom:20px;
}

.progress {
  background:#e5e7eb;
  border-radius:10px;
  overflow:hidden;
  margin-bottom:10px;
}

.progress div {
  height:10px;
  width:0%;
  background:var(--correct);
  transition:width .3s ease;
}

.topic {
  font-size:14px;
  margin-top:8px;
}

.word {
  padding:8px;
  background:#e5e7eb;
  margin:6px;
  border-radius:6px;
  cursor:grab;
}

.drop {
  padding:8px;
  background:#fef3c7;
  margin:6px;
  border-radius:6px;
  min-width:160px;
}

button {
  padding:10px 16px;
  background:var(--primary);
  color:white;
  border:none;
  border-radius:6px;
  cursor:pointer;
  margin-top:12px;
}

input {
  width:100%;
  padding:10px;
  margin-top:10px;
  font-size:16px;
}

#dailyContainer {
  margin-bottom:20px;
}

#dailyBarContainer {
  background:#e5e7eb;
  border-radius:10px;
  overflow:hidden;
  height:12px;
}

#dailyBar {
  height:12px;
  width:0%;
  background:var(--primary);
  transition:width .3s ease;
}

@keyframes slideIn {
  from {opacity:0; transform:translateX(20px);}
  to {opacity:1; transform:translateX(0);}
}
</style>
</head>

<body>

<header>
  <h1>üá©üá™ German Trainer</h1>
  <p>Grammar topics ‚Ä¢ Vocabulary ‚Ä¢ No repeats</p>
</header>

<main>

  <!-- DAILY PROGRESS -->
  <div id="dailyContainer" class="card">
    <h3>üî• Daily Goal</h3>
    <div id="dailyBarContainer"><div id="dailyBar"></div></div>
    <p id="dailyText"></p>
  </div>

  <!-- GRAMMAR DASHBOARD -->
  <div class="card">
    <h3>üìä Grammar Progress</h3>
    <div id="grammarBars"></div>
  </div>

  <!-- EXERCISE -->
  <div class="card">
    <h2 id="meta"></h2>
    <div id="content"></div>
    <div id="feedback"></div>
    <button onclick="nextExercise()">Next</button>
  </div>

</main>

<script>
/* ================= STATE ================= */
let enterMode = "check"; 
let current = null;
let dragged = null;

/* ================= DATE HELPERS ================= */
function today() { return new Date().toISOString().split("T")[0]; }

/* ================= STORAGE ================= */
let grammarStats = JSON.parse(localStorage.getItem("grammarStats")) || {};
let seenToday = JSON.parse(localStorage.getItem("seenToday")) || {};
let seenWeek = JSON.parse(localStorage.getItem("seenWeek")) || {};
let daily = JSON.parse(localStorage.getItem("daily")) || {
  date: today(),
  done: 0,
  goal: 10,
  streak: 0,
  lastDate: null
};

/* reset daily */
if (daily.date !== today()) {
  if (daily.lastDate === new Date(Date.now()-86400000).toISOString().split("T")[0]) {
    daily.streak++;
  } else { daily.streak = 1; }
  daily.lastDate = daily.date;
  daily.date = today();
  daily.done = 0;
  seenToday = {};
}

/* ================= DATA ================= */
const grammar = [
  {id:"g1",lvl:"B1",topic:"W√ºnsche",q:"Ich ___ mehr Deutsch lernen.",a:"m√∂chte"},
  {id:"g2",lvl:"B2",topic:"W√ºnsche",q:"Ich w√ºnschte, ich ___ mehr Zeit.",a:"h√§tte"},
  {id:"g3",lvl:"C1",topic:"W√ºnsche",q:"Man h√§tte gewollt, dass er fr√ºher ___ .",a:"k√§me"},
  {id:"g4",lvl:"B1",topic:"Nebens√§tze",q:"Ich bleibe zu Hause, ___ es regnet.",a:"weil"},
  {id:"g5",lvl:"B2",topic:"Nebens√§tze",q:"Er ging, obwohl er ___ m√ºde war.",a:"sehr"},
  {id:"g6",lvl:"C1",topic:"Nebens√§tze",q:"Nicht nur ___ er kam, sondern blieb.",a:"dass"},
  {id:"g7",lvl:"B1",topic:"Konjunktiv II",q:"Wenn ich Zeit ___, k√§me ich.",a:"h√§tte"},
  {id:"g8",lvl:"B2",topic:"Konjunktiv II",q:"Er tat so, als ___ er nichts.",a:"w√ºsste"},
  {id:"g9",lvl:"C1",topic:"Konjunktiv II",q:"Es w√§re besser gewesen, man ___ fr√ºher reagiert.",a:"h√§tte"}
];

const writingTasks = [
  {id:"w1",lvl:"B1",topic:"Nebens√§tze",prompt:"Schreibe einen Satz mit ‚Äûweil‚Äú √ºber deine Arbeit.",mustInclude:["weil"],verbAtEnd:true,model:"Ich lerne Deutsch, weil ich in der Schweiz arbeite."},
  {id:"w2",lvl:"B2",topic:"obwohl",prompt:"Schreibe einen Satz mit ‚Äûobwohl‚Äú √ºber Zeit.",mustInclude:["obwohl"],verbAtEnd:true,model:"Ich lerne Deutsch, obwohl ich wenig Zeit habe."},
  {id:"w3",lvl:"C1",topic:"Konjunktiv II",prompt:"Schreibe einen Satz mit Konjunktiv II (h√§tte/w√§re).",mustInclude:["h√§tte","w√§re","w√ºrde"],model:"Wenn ich mehr Zeit h√§tte, w√ºrde ich mehr lesen."}
];

const vocab = [
  {id:"v1",pairs:[["arbeiten","work"],["die Pause","break"],["der Alltag","daily life"]]},
  {id:"v2",pairs:[["vermeiden","avoid"],["erreichen","achieve"],["die Verantwortung","responsibility"]]}
];

/* ================= LEVEL LOGIC ================= */
function topicLevel(topic) {
  const s = grammarStats[topic];
  if (!s) return "B1";
  const p = s.correct / s.done;
  if (p < 0.6) return "B1";
  if (p < 0.8) return "B2";
  return "C1";
}

/* ================= GENERATION ================= */
function generateGrammar() {
  const topics = [...new Set(grammar.map(g=>g.topic))];
  const topic = topics[Math.floor(Math.random()*topics.length)];
  const lvl = topicLevel(topic);
  let pool = grammar.filter(g => g.topic===topic && g.lvl===lvl && !seenToday[g.id] && !seenWeek[g.id]);
  if(pool.length===0) pool = grammar.filter(g=>g.topic===topic && g.lvl===lvl);
  return pool[Math.floor(Math.random()*pool.length)];
}

function generateVocab() {
  let pool = vocab.filter(v => !seenToday[v.id] && !seenWeek[v.id]);
  if(pool.length===0) pool = vocab;
  return pool[Math.floor(Ma]()
