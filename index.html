<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>German Trainer â€“ Correct & Adaptive</title>
<style>
:root {
  --bg:#f0f4f8;
  --card:#ffffff;
  --text:#222;
  --primary:#2563eb;
  --correct:#16a34a;
  --wrong:#dc2626;
}
body {margin:0;font-family:'Segoe UI',sans-serif;background:var(--bg);color:var(--text);}
header {background:var(--primary);color:white;padding:20px;text-align:center;}
header h1 {margin:0;font-size:2em;}
header p {margin:4px;font-size:1em;}
main {max-width:800px;margin:auto;padding:20px;}
.card {background:var(--card);padding:20px;border-radius:12px;box-shadow:0 8px 20px rgba(0,0,0,0.1);margin-bottom:20px;transition:transform .3s;}
.card:hover{transform:translateY(-5px);}
button{padding:10px 16px;background:var(--primary);color:white;border:none;border-radius:8px;cursor:pointer;margin-top:12px;transition:background .2s;}
button:hover{background:#1d4ed8;}
.choice{display:block;margin:6px 0;padding:10px;background:#e5e7eb;border-radius:6px;cursor:pointer;transition:background .2s;}
.choice:hover{background:#dbeafe;}
input{width:100%;padding:10px;margin-top:10px;font-size:16px;}
#feedback{margin-top:12px;font-weight:bold;}
#dailyBarContainer{background:#e5e7eb;border-radius:10px;overflow:hidden;height:14px;}
#dailyBar{height:14px;width:0%;background:var(--primary);transition:width .3s;}
</style>
</head>
<body>
<header>
<h1>ðŸ‡©ðŸ‡ª German Trainer</h1>
<p>Grammar â€¢ Vocabulary â€¢ Articles â€¢ Writing â€¢ Reading Comprehension</p>
</header>
<main>
<div id="dailyCard" class="card">
<h3>ðŸ”¥ Daily Progress</h3>
<div id="dailyBarContainer"><div id="dailyBar"></div></div>
<p id="dailyText"></p>
</div>

<div class="card">
<h3>ðŸ“Š Topic Progress</h3>
<div id="grammarBars"></div>
</div>

<div class="card">
<h2 id="meta"></h2>
<div id="content"></div>
<div id="feedback"></div>
<button id="nextBtn">Next</button>
</div>
</main>

<script>
/* ================= STATE ================= */
let current=null, enterMode="check";
let stats=JSON.parse(localStorage.getItem("stats"))||{};
let daily=JSON.parse(localStorage.getItem("daily"))||{date:new Date().toISOString().split("T")[0], done:0, streak:0, lastDate:null};

/* reset daily */
if(daily.date!==new Date().toISOString().split("T")[0]){
  daily.streak=(daily.lastDate===new Date(Date.now()-86400000).toISOString().split("T")[0])? daily.streak+1:1;
  daily.lastDate=daily.date;
  daily.date=new Date().toISOString().split("T")[0]; daily.done=0;
}

/* ================= DATA ================= */
/* Grammar templates */
const grammarTemplates=[
  {q:"Ich ___ gern ins Kino, weil es regnet.",options:["gehe","bleibe","spiele"],answer:"gehe"},
  {q:"Wenn ich Zeit ___, ___ ich dich besuchen.",options:["hÃ¤tte","wÃ¼rde","war"],answer:"hÃ¤tte"},
  {q:"Er tut so, als ob er ___ nichts.",options:["wÃ¼sste","hatte","konnte"],answer:"wÃ¼sste"},
];

/* Writing templates */
const writingTemplates=[
  {prompt:"Schreibe einen Satz mit 'weil' Ã¼ber deine Arbeit.",answer:"Ich lerne Deutsch, weil ich arbeite."},
  {prompt:"Schreibe einen Satz mit 'obwohl' Ã¼ber deine Schule.",answer:"Ich lerne Deutsch, obwohl ich mÃ¼de bin."}
];

/* Vocabulary */
const vocabList=[
  ["arbeiten","to work"],["lernen","to learn"],["Haus","house"],["Katze","cat"],["Buch","book"]
];

/* Articles */
const articlesList=[
  {word:"Apfel",art:"der"},{word:"Banane",art:"die"},{word:"MÃ¤dchen",art:"das"},{word:"Hund",art:"der"},{word:"Katze",art:"die"}
];

/* Reading comprehension texts */
const readingPool=[
{text:"Anna geht in die Schule. Sie lernt Deutsch und spielt danach im Park.",
 questions:[
  {q:"Wo geht Anna jeden Tag?",options:["in die Schule","im Park","zu Hause"],answer:"in die Schule"},
  {q:"Was macht sie nach der Schule?",options:["lernt","spielt im Park","schlÃ¤ft"],answer:"spielt im Park"}
]},
{text:"Max arbeitet im BÃ¼ro. Er mag seine Arbeit, aber manchmal ist sie stressig.",
 questions:[
  {q:"Wo arbeitet Max?",options:["im BÃ¼ro","in der Schule","im Park"],answer:"im BÃ¼ro"},
  {q:"Wie empfindet er seine Arbeit manchmal?",options:["stressig","leicht","langweilig"],answer:"stressig"}
]}
];

/* ================= UTILS ================= */
function shuffle(a){return a.sort(()=>Math.random()-0.5);}
function saveAll(){localStorage.setItem("stats",JSON.stringify(stats));localStorage.setItem("daily",JSON.stringify(daily));}

/* ================= EXERCISE GENERATORS ================= */
function generateGrammar(){
  const g=grammarTemplates[Math.floor(Math.random()*grammarTemplates.length)];
  return {...g,id:"g-"+Date.now()+Math.random(),topic:"Grammar"};
}

function generateWriting(){
  const w=writingTemplates[Math.floor(Math.random()*writingTemplates.length)];
  const choices=shuffle([w.answer,"Ich lerne Deutsch.","Ich gehe zur Schule."]);
  return {...w,id:"w-"+Date.now()+Math.random(),choices,topic:"Writing"};
}

function generateVocab(){
  const v=shuffle(vocabList).slice(0,3);
  return {id:"v-"+Date.now()+Math.random(),pairs:v,topic:"Vocabulary"};
}

function generateArticle(){
  const a=articlesList[Math.floor(Math.random()*articlesList.length)];
  return {id:"a-"+Date.now()+Math.random(),word:a.word,article:a.art,topic:"Articles"};
}

function generateReading(){
  const r=readingPool[Math.floor(Math.random()*readingPool.length)];
  const q=r.questions[Math.floor(Math.random()*r.questions.length)];
  return {...q,text:r.text,id:"r-"+Date.now()+Math.random(),topic:"Reading"};
}

/* ================= FLOW ================= */
function nextExercise(){
  enterMode="check";
  document.getElementById("feedback").innerHTML="";
  const r=Math.random();
  if(r<0.2) current=generateGrammar();
  else if(r<0.4) current=generateVocab();
  else if(r<0.6) current=generateWriting();
  else if(r<0.8) current=generateArticle();
  else current=generateReading();
  renderExercise();
}

function renderExercise(){
  const meta=document.getElementById("meta");
  const content=document.getElementById("content");
  if(current.topic==="Grammar"||current.topic==="Writing") meta.innerHTML=current.topic;
  else meta.innerHTML=current.topic;

  if(current.topic==="Grammar"){
    content.innerHTML=`<p>${current.q}</p>`+current.options.map(o=>`<div class="choice" onclick="checkChoice('${o}')">${o}</div>`).join("");
  } else if(current.topic==="Writing"){
    content.innerHTML=`<p>${current.prompt}</p>`+current.choices.map(o=>`<div class="choice" onclick="checkChoice('${o}')">${o}</div>`).join("");
  } else if(current.topic==="Vocabulary"){
    content.innerHTML=current.pairs.map(p=>`<p>${p[0]} â†’ ? <b>${p[1]}</b></p>`).join("");
    stats[current.id]={done:current.pairs.length,correct:current.pairs.length};
  } else if(current.topic==="Articles"){
    content.innerHTML=`<p>WÃ¤hle den richtigen Artikel fÃ¼r <b>${current.word}</b>:</p>`+["der","die","das"].map(a=>`<button onclick="checkArticle('${a}')">${a}</button>`).join("");
  } else if(current.topic==="Reading"){
    content.innerHTML=`<p>${current.text}</p><p>${current.q}</p>`+current.options.map(o=>`<div class="choice" onclick="checkChoice('${o}')">${o}</div>`).join("");
  }
}

/* ================= CHECK ================= */
function checkChoice(choice){
  const fb=document.getElementById("feedback");
  const correct=(current.answer||current.answer)===choice;
  fb.style.color=correct?"green":"red";
  fb.innerHTML=correct?"âœ” Correct!":`âœ˜ Correct: <b>${current.answer}</b>`;
  stats[current.id]=stats[current.id]||{done:0,correct:0,wrong:0};
  stats[current.id].done++; correct?stats[current.id].correct++:stats[current.id].wrong++;
  daily.done++; saveAll(); renderDaily(); renderGrammarBars();
}

function checkArticle(article){
  const fb=document.getElementById("feedback");
  const ok=article===current.article;
  fb.style.color=ok?"green":"red";
  fb.innerHTML=ok?"âœ” Correct!":`âœ˜ Correct: <b>${current.article}</b>`;
  stats[current.word]=stats[current.word]||{done:0,correct:0,wrong:0};
  stats[current.word].done++; ok?stats[current.word].correct++:stats[current.word].wrong++;
  daily.done++; saveAll(); renderDaily();
}

/* ================= DASHBOARD ================= */
function renderGrammarBars(){
  const box=document.getElementById("grammarBars"); box.innerHTML="";
  for(let t in stats){
    const s=stats[t]; const p=Math.round(s.correct/(s.done||1)*100);
    box.innerHTML+=`<div>${t} (${p}%)</div><div class="progress"><div style="width:${p}%"></div></div>`;
  }
}
function renderDaily(){
  const pct=Math.min(100,Math.round(daily.done/20*100));
  document.getElementById("dailyBar").style.width=pct+"%";
  document.getElementById("dailyText").innerText=`${daily.done} exercises â€¢ ðŸ”¥ ${daily.streak} day streak`;
}

/* ================= EVENTS ================= */
document.getElementById("nextBtn").addEventListener("click",()=>{nextExercise();});

/* ================= START ================= */
renderDaily(); renderGrammarBars(); nextExercise();
</script>
</body>
</html>
