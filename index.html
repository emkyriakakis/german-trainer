<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>German Trainer â€“ Adaptive</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{font-family:system-ui;background:#f3f4f6;margin:0}
header{background:#1e40af;color:white;padding:20px;text-align:center}
main{max-width:900px;margin:auto;padding:20px}
.card{background:white;padding:20px;border-radius:16px;margin-bottom:20px;box-shadow:0 10px 25px rgba(0,0,0,.1)}
h2,h3{margin-top:0}
.choice{padding:12px;margin:8px 0;background:#e5e7eb;border-radius:10px;cursor:pointer}
.choice:hover{background:#dbeafe}
.correct{background:#16a34a;color:white}
.wrong{background:#dc2626;color:white}
button{padding:12px 20px;border:none;border-radius:10px;background:#2563eb;color:white;font-weight:600;cursor:pointer}
.progress{background:#e5e7eb;border-radius:10px;height:14px;margin-bottom:10px}
.progress div{height:14px;border-radius:10px;background:#16a34a}
.badge{display:inline-block;padding:4px 10px;border-radius:12px;background:#e0e7ff;color:#1e40af;font-size:12px}
</style>
</head>
<body>
<header>
<h1>ðŸ‡©ðŸ‡ª German Trainer</h1>
<p>Adaptive â€¢ Correct German â€¢ No Repetition</p>
</header>
<main>

<div class="card">
<h3>ðŸ“… Daily Goal</h3>
<p><span id="dailyDone">0</span> / 20 exercises completed</p>
<div class="progress"><div id="dailyBar" style="width:0%"></div></div>
<p>ðŸ”¥ Streak: <span id="streak">0</span> days</p>
</div>

<div class="card">
<h3>ðŸ“Š Topic Progress</h3>
<div id="progressBox"></div>
</div>

<div class="card">
<span class="badge" id="level">B1</span>
<span class="badge" id="xpBadge">XP: 0</span>
<h2 id="question"></h2>
<div id="choices"></div>
<div id="feedback"></div>
<button id="nextBtn">Next</button>
</div>

</main>
<script>
/* ===== STATE ===== */
let checked = false;
let current = null;
let dailyDone = Number(localStorage.getItem('dailyDone')) || 0;
let lastDate = localStorage.getItem('lastDate');
let today = new Date().toDateString();
let streak = Number(localStorage.getItem('streak')) || 0;

if (lastDate !== today) {
  dailyDone = 0;
  localStorage.setItem('dailyDone', 0);
  if (lastDate) streak++;
  localStorage.setItem('streak', streak);
  localStorage.setItem('lastDate', today);
  localStorage.removeItem('usedIds');
}

let usedIds = JSON.parse(localStorage.getItem('usedIds')) || [];

let stats = JSON.parse(localStorage.getItem('stats')) || {
  Articles: { done: 0, correct: 0 }
};

/* ===== SMART CONTENT POOLS ===== */
const nouns = [
  { w: 'Hund', a: 'der' },
  { w: 'Apfel', a: 'der' },
  { w: 'Baum', a: 'der' },
  { w: 'Frau', a: 'die' },
  { w: 'Stadt', a: 'die' },
  { w: 'Zeit', a: 'die' },
  { w: 'Haus', a: 'das' },
  { w: 'Kind', a: 'das' },
  { w: 'Auto', a: 'das' }
];

const subjects = ['Der Mann', 'Die Frau', 'Das Kind', 'Mein Freund', 'Meine Schwester'];
const verbs = ['kauft', 'sieht', 'mag', 'findet', 'braucht'];
const places = ['im Park', 'im Supermarkt', 'zu Hause', 'in der Stadt', 'am Abend'];

function uid(str) {
  return btoa(unescape(encodeURIComponent(str))).slice(0, 30);
}

/* ===== GENERATOR (NO REPETITION) ===== */
function generateExercise() {
  let ex, id;
  let tries = 0;

  do {
    tries++;
    const n = nouns[Math.floor(Math.random() * nouns.length)];
    const s = subjects[Math.floor(Math.random() * subjects.length)];
    const v = verbs[Math.floor(Math.random() * verbs.length)];
    const p = places[Math.floor(Math.random() * places.length)];

    ex = {
      topic: 'Articles',
      q: `${s} ${v} ___ ${n.w} ${p}.`,
      options: shuffle(['der', 'die', 'das']),
      a: n.a
    };

    id = uid(ex.q + ex.a);
  } while (usedIds.includes(id) && tries < 100);

  usedIds.push(id);
  localStorage.setItem('usedIds', JSON.stringify(usedIds));
  ex.id = id;
  return ex;
}

function shuffle(arr) {
  return arr.sort(() => Math.random() - 0.5);
}

/* ===== RENDER ===== */
function render() {
  checked = false;
  current = generateExercise();
  document.getElementById('feedback').innerHTML = '';
  document.getElementById('question').innerText = current.q;
  document.getElementById('choices').innerHTML = current.options
    .map(o => `<div class="choice" onclick="select('${o}',this)">${o}</div>`)
    .join('');
}

/* ===== CHECK ===== */
function select(val, el) {
  if (checked) return;
  checked = true;

  const ok = val === current.a;
  el.classList.add(ok ? 'correct' : 'wrong');

  document.getElementById('feedback').innerHTML = ok
    ? 'âœ” Richtig'
    : `âœ˜ Richtig ist: <b>${current.a}</b>`;

  stats[current.topic].done++;
  if (ok) stats[current.topic].correct++;

  dailyDone++;
  localStorage.setItem('dailyDone', dailyDone);
  localStorage.setItem('stats', JSON.stringify(stats));
  updateUI();
}

/* ===== ENTER KEY ===== */
document.addEventListener('keydown', e => {
  if (e.key === 'Enter') {
    if (!checked) return;
    render();
  }
});

/* ===== UI ===== */
function updateUI() {
  document.getElementById('dailyDone').innerText = dailyDone;
  document.getElementById('dailyBar').style.width = Math.min(100, (dailyDone / 20) * 100) + '%';
  document.getElementById('streak').innerText = streak;

  const box = document.getElementById('progressBox');
  box.innerHTML = '';
  for (let t in stats) {
    const s = stats[t];
    const p = s.done ? Math.round((s.correct / s.done) * 100) : 0;
    box.innerHTML += `<div>${t} (${p}%)</div><div class="progress"><div style="width:${p}%"></div></div>`;
  }
}

/* ===== INIT ===== */
updateUI();
render();
document.getElementById('nextBtn').onclick = render;
</script>
</body>
</html>
