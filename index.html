<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>German Trainer â€“ Adaptive & Stylish</title>
<style>
:root {
  --bg:#f0f4f8;
  --card:#ffffff;
  --text:#222;
  --primary:#2563eb;
  --correct:#16a34a;
  --wrong:#dc2626;
  --hover:#e0ebff;
  --b1:#93c5fd;
  --b2:#facc15;
  --c1:#f87171;
}
body {margin:0; font-family:'Segoe UI',sans-serif; background:var(--bg); color:var(--text);}
header {background:var(--primary); color:white; padding:20px; text-align:center;}
header h1 {margin:0; font-size:2em;}
header p {margin:4px; font-size:1em;}
main {max-width:800px; margin:auto; padding:20px;}
.card {background:var(--card); padding:20px; border-radius:12px; box-shadow:0 8px 20px rgba(0,0,0,0.1); margin-bottom:20px; transition: transform 0.3s; }
.card:hover {transform: translateY(-5px);}
.progress {background:#e5e7eb; border-radius:10px; overflow:hidden; margin:6px 0;}
.progress div {height:12px; width:0%; background:var(--correct); transition:width .3s ease;}
.word {padding:10px; background:#e5e7eb; margin:6px; border-radius:6px; cursor:grab; user-select:none; transition:background 0.2s;}
.word:hover {background:var(--hover);}
.drop {padding:10px; background:#fef3c7; margin:6px; border-radius:6px; min-width:140px; text-align:center;}
button {padding:10px 16px; background:var(--primary); color:white; border:none; border-radius:8px; cursor:pointer; margin-top:12px; transition:background 0.2s;}
button:hover {background:#1d4ed8;}
input {width:100%; padding:12px; margin-top:10px; font-size:16px; border-radius:6px; border:1px solid #ccc;}
.level {display:inline-block; padding:2px 8px; border-radius:8px; color:white; margin-left:8px; font-size:0.8em;}
#dailyContainer {margin-bottom:20px;}
#dailyBarContainer {background:#e5e7eb; border-radius:10px; overflow:hidden; height:14px;}
#dailyBar {height:14px; width:0%; background:var(--primary); transition:width .3s ease;}
#feedback {margin-top:12px; font-weight:bold;}
</style>
</head>
<body>
<header>
  <h1>ðŸ‡©ðŸ‡ª German Trainer</h1>
  <p>Adaptive Grammar â€¢ Vocabulary â€¢ Articles â€¢ Unlimited Practice</p>
</header>
<main>
  <div id="dailyContainer" class="card">
    <h3>ðŸ”¥ Daily Progress</h3>
    <div id="dailyBarContainer"><div id="dailyBar"></div></div>
    <p id="dailyText"></p>
  </div>
  <div class="card">
    <h3>ðŸ“Š Topic Progress</h3>
    <div id="grammarBars"></div>
  </div>
  <div class="card">
    <h2 id="meta"></h2>
    <div id="content"></div>
    <div id="feedback"></div>
    <button onclick="nextExercise()">Next</button>
  </div>
</main>
<script>
/* ================= STATE ================= */
let current=null, dragged=null;
let grammarPool=[], vocabPool=[], writingPool=[], articlePool=[];

/* ================= STORAGE ================= */
let stats=JSON.parse(localStorage.getItem("stats"))||{};
let daily=JSON.parse(localStorage.getItem("daily"))||{date:new Date().toISOString().split("T")[0], done:0, streak:0, lastDate:null};
if(daily.date!==new Date().toISOString().split("T")[0]){
  daily.streak=(daily.lastDate===new Date(Date.now()-86400000).toISOString().split("T")[0])? daily.streak+1:1;
  daily.lastDate=daily.date;
  daily.date=new Date().toISOString().split("T")[0]; daily.done=0;
}

/* ================= DATA ================= */
const grammar=[
  {id:"g1",lvl:"B1",topic:"WÃ¼nsche",q:"Ich ___ mehr Deutsch lernen.",a:"mÃ¶chte"},
  {id:"g2",lvl:"B2",topic:"WÃ¼nsche",q:"Ich wÃ¼nschte, ich ___ mehr Zeit.",a:"hÃ¤tte"},
  {id:"g3",lvl:"C1",topic:"WÃ¼nsche",q:"Man hÃ¤tte gewollt, dass er frÃ¼her ___ .",a:"kÃ¤me"},
  {id:"g4",lvl:"B1",topic:"NebensÃ¤tze",q:"Ich bleibe zu Hause, ___ es regnet.",a:"weil"},
  {id:"g5",lvl:"B2",topic:"NebensÃ¤tze",q:"Er ging, obwohl er ___ mÃ¼de war.",a:"sehr"},
  {id:"g6",lvl:"C1",topic:"NebensÃ¤tze",q:"Nicht nur ___ er kam, sondern blieb.",a:"dass"},
  {id:"g7",lvl:"B1",topic:"Konjunktiv II",q:"Wenn ich Zeit ___, kÃ¤me ich.",a:"hÃ¤tte"},
  {id:"g8",lvl:"B2",topic:"Konjunktiv II",q:"Er tat so, als ___ er nichts.",a:"wÃ¼sste"},
  {id:"g9",lvl:"C1",topic:"Konjunktiv II",q:"Es wÃ¤re besser gewesen, man ___ frÃ¼her reagiert.",a:"hÃ¤tte"}
];

const writingTasks=[
  {id:"w1",lvl:"B1",topic:"NebensÃ¤tze",prompt:"Schreibe einen Satz mit â€žweilâ€œ Ã¼ber deine Arbeit.",mustInclude:["weil"],verbAtEnd:true,model:"Ich lerne Deutsch, weil ich in der Schweiz arbeite."},
  {id:"w2",lvl:"B2",topic:"obwohl",prompt:"Schreibe einen Satz mit â€žobwohlâ€œ Ã¼ber Zeit.",mustInclude:["obwohl"],verbAtEnd:true,model:"Ich lerne Deutsch, obwohl ich wenig Zeit habe."},
  {id:"w3",lvl:"C1",topic:"Konjunktiv II",prompt:"Schreibe einen Satz mit Konjunktiv II (hÃ¤tte/wÃ¤re).",mustInclude:["hÃ¤tte","wÃ¤re","wÃ¼rde"],model:"Wenn ich mehr Zeit hÃ¤tte, wÃ¼rde ich mehr lesen."}
];

const vocab=[
  {id:"v1",pairs:[["arbeiten","work"],["die Pause","break"],["der Alltag","daily life"]]},
  {id:"v2",pairs:[["vermeiden","avoid"],["erreichen","achieve"],["die Verantwortung","responsibility"]]}
];

const articles=[
  {id:"a1",word:"Apfel",article:"der"},
  {id:"a2",word:"Banane",article:"die"},
  {id:"a3",word:"MÃ¤dchen",article:"das"}
];

/* ================= UTILS ================= */
function shuffle(a){return a.sort(()=>Math.random()-0.5);}
function saveAll(){localStorage.setItem("stats",JSON.stringify(stats)); localStorage.setItem("daily",JSON.stringify(daily));}

/* ================= LEVEL ================= */
function topicLevel(topic){
  const s=stats[topic]; if(!s) return "B1";
  const p=s.correct/(s.done||1);
  if(p<0.6) return "B1"; if(p<0.8) return "B2"; return "C1";
}

/* ================= GENERATE ================= */
function nextExercise(){
  let pool;
  const r=Math.random();
  if(r<0.35) pool=grammarPool.length?grammarPool:grammar.slice(); 
  else if(r<0.6) pool=vocabPool.length?vocabPool:vocab.slice(); 
  else if(r<0.8) pool=writingPool.length?writingPool:writingTasks.slice(); 
  else pool=articlePool.length?articlePool:articles.slice();
  
  shuffle(pool);
  current=pool.pop(); // remove to avoid repeat
  if(pool===grammarPool) grammarPool=pool;
  if(pool===vocabPool) vocabPool=pool;
  if(pool===writingPool) writingPool=pool;
  if(pool===articlePool) articlePool=pool;
  
  renderExercise();
}

function renderExercise(){
  document.getElementById("feedback").innerHTML="";
  const meta=document.getElementById("meta");
  const content=document.getElementById("content");
  if(current.topic) meta.innerHTML=`${current.lvl} â€¢ ${current.topic} <span class="level" style="background:${current.lvl==='B1'?'var(--b1)':current.lvl==='B2'?'var(--b2)':'var(--c1)'}">${current.lvl}</span>`;
  else meta.innerHTML="Vocabulary/Articles";
  
  if(current.pairs){ // vocab
    const left=shuffle([...current.pairs]), right=shuffle([...current.pairs.map(p=>p[1])]);
    content.innerHTML=`<p>Match German â†’ English</p>
      <div style="display:flex;gap:20px;">
        <div>${left.map(p=>`<div draggable="true" ondragstart="dragged='${p[0]}'" class="word">${p[0]}</div>`).join("")}</div>
        <div>${right.map(r=>`<div class="drop" ondragover="event.preventDefault()" ondrop="drop('${r}',this)">${r}</div>`).join("")}</div>
      </div>`;
  } else if(current.q){ // grammar
    content.innerHTML=`<p>${current.q}</p><input id="answer" placeholder="Press ENTER" autofocus>`;
    document.getElementById("answer").addEventListener("keydown",e=>{if(e.key==="Enter") checkGrammar();});
  } else if(current.prompt){ // writing
    content.innerHTML=`<p>${current.prompt}</p><input id="answer" placeholder="Press ENTER" autofocus>`;
    document.getElementById("answer").addEventListener("keydown",e=>{if(e.key==="Enter") checkWriting();});
  } else if(current.word){ // articles
    content.innerHTML=`<p>Choose the correct article for <b>${current.word}</b>:</p>${["der","die","das"].map(a=>`<button onclick="checkArticle('${a}')">${a}</button>`).join("")}`;
  }
}

/* ================= CHECK ================= */
function checkGrammar(){
  const val=document.getElementById("answer").value.trim().toLowerCase();
  const fb=document.getElementById("feedback");
  const ok=val===current.a;
  stats[current.topic]=stats[current.topic]||{done:0,correct:0,wrong:0};
  stats[current.topic].done++; if(ok) stats[current.topic].correct++; else stats[current.topic].wrong++;
  fb.style.color=ok?"green":"red";
  fb.innerHTML=ok?"âœ” Correct!":`âœ˜ Wrong! Correct: <b>${current.a}</b>`;
  daily.done++; saveAll(); renderDaily(); renderGrammarBars();
}

function checkWriting(){
  const val=document.getElementById("answer").value.toLowerCase();
  const fb=document.getElementById("feedback"); let ok=true; let hints=[];
  if(current.mustInclude && !current.mustInclude.some(w=>val.includes(w))){ok=false; hints.push("ðŸ”Ž Use correct structure.");}
  if(current.verbAtEnd){const last=val.split(" ").pop(); if(!last.match(/(habe|hat|bin|ist|war|wÃ¤re|hÃ¤tte|wÃ¼rde|arbeite|lerne|komme)/)){ok=false; hints.push("ðŸ“Œ Verb should be at the end.");}}
  fb.style.color=ok?"green":"orange";
  fb.innerHTML=ok?"âœ” Good structure!":hints.join("<br>")+`<hr>Example:<br><b>${current.model}</b>`;
  stats[current.topic]=stats[current.topic]||{done:0,correct:0,wrong:0};
  stats[current.topic].done++; if(ok) stats[current.topic].correct++; else stats[current.topic].wrong++;
  daily.done++; saveAll(); renderDaily(); renderGrammarBars();
}

function checkArticle(article){
  const fb=document.getElementById("feedback");
  const ok=article===current.article;
  fb.style.color=ok?"green":"red";
  fb.innerHTML=ok?"âœ” Correct!":`âœ˜ Wrong! Correct: <b>${current.article}</b>`;
  stats[current.word]=stats[current.word]||{done:0,correct:0,wrong:0};
  stats[current.word].done++; if(ok) stats[current.word].correct++; else stats[current.word].wrong++;
  daily.done++; saveAll(); renderDaily();
}

function drop(en,el){
  const p=current.pairs.find(x=>x[1]===en);
  const fb=document.getElementById("feedback");
  if(p[0]===dragged){el.innerText="âœ” "+en; el.style.background="#bbf7d0"; stats[current.id]=stats[current.id]||{done:0,correct:0,wrong:0}; stats[current.id].correct++;} 
  else {el.innerHTML=`âœ˜ ${p[0]} â†’ ${p[1]}`; el.style.background="#fecaca"; stats[current.id]=stats[current.id]||{done:0,correct:0,wrong:0}; stats[current.id].wrong++;}
  stats[current.id].done++; daily.done++; saveAll(); renderDaily(); renderGrammarBars();
}

/* ================= DASHBOARD ================= */
function renderGrammarBars(){
  const box=document.getElementById("grammarBars"); box.innerHTML="";
  for(let t in stats){
    const s=stats[t]; const p=Math.round(s.correct/(s.done||1)*100);
    box.innerHTML+=`<div>${t} (${p}%)</div><div class="progress"><div style="width:${p}%"></div></div>`;
  }
}
function renderDaily(){
  const pct=Math.min(100,Math.round(daily.done/20*100));
  document.getElementById("dailyBar").style.width=pct+"%";
  document.getElementById("dailyText").innerText=`${daily.done} exercises â€¢ ðŸ”¥ ${daily.streak} day streak`;
}

/* ================= START ================= */
renderDaily(); renderGrammarBars(); nextExercise();
</script>
</body>
</html>
