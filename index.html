<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>German Trainer B1â€“C1</title>

<style>
:root {
  --bg: #f4f6f8;
  --card: #ffffff;
  --text: #222;
  --primary: #2563eb;
  --correct: #16a34a;
  --wrong: #dc2626;
}

body.dark {
  --bg: #0f172a;
  --card: #1e293b;
  --text: #e5e7eb;
  --primary: #60a5fa;
}

body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: var(--bg);
  color: var(--text);
  transition: background 0.3s, color 0.3s;
}

header {
  background: var(--primary);
  color: white;
  padding: 16px;
  text-align: center;
}

main {
  max-width: 800px;
  margin: auto;
  padding: 16px;
}

.lesson {
  background: var(--card);
  padding: 16px;
  border-radius: 10px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.1);
}

.animate {
  animation: slideIn 0.4s ease;
}

button {
  background: var(--primary);
  color: white;
  border: none;
  padding: 10px 14px;
  margin-top: 10px;
  border-radius: 6px;
  font-size: 16px;
  cursor: pointer;
  transition: transform 0.15s, opacity 0.15s;
}

button:hover {
  transform: scale(1.05);
  opacity: 0.9;
}

input {
  padding: 8px;
  width: 90%;
  max-width: 300px;
  margin-top: 6px;
  border-radius: 6px;
  border: 1px solid #ccc;
}

#feedback {
  margin-top: 10px;
  animation: fadeIn 0.3s ease;
}

.toggle {
  position: fixed;
  top: 12px;
  right: 12px;
}

@keyframes slideIn {
  from { opacity: 0; transform: translateX(30px); }
  to { opacity: 1; transform: translateX(0); }
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}
</style>
</head>

<body>

<button class="toggle" onclick="toggleDark()">ðŸŒ™</button>

<header>
  <h1>ðŸ‡©ðŸ‡ª German Trainer</h1>
  <p>B1 â†’ C1 â€¢ Practice</p>
</header>

<main>

<!-- PROGRESS -->
<div style="margin-bottom:16px;">
  <b>Progress</b>
  <div style="background:#ddd;border-radius:6px;overflow:hidden;">
    <div id="progressBar" style="height:12px;width:0%;background:#16a34a"></div>
  </div>
  <div id="stats"></div>
  <div id="streak">ðŸ”¥ Streak: 0 days</div>
</div>

<div class="lesson" id="lessonBox"></div>

</main>

<script>
const grammarPool = {
  B1: [
    { q: "Ich ___ mehr Deutsch lernen.", a: "mÃ¶chte", topic: "WÃ¼nsche" },
    { q: "Er bleibt zu Hause, ___ es regnet.", a: "weil", topic: "Nebensatz" },
    { q: "Gestern ___ ich lange gearbeitet.", a: "habe", topic: "Perfekt" }
  ],
  B2: [
    { q: "Wenn ich mehr Zeit ___, wÃ¼rde ich reisen.", a: "hÃ¤tte", topic: "Konjunktiv II" },
    { q: "Das ist der Mann, ___ ich geholfen habe.", a: "dem", topic: "Relativsatz" }
  ],
  C1: [
    { q: "HÃ¤tte man frÃ¼her reagiert, ___ der Schaden kleiner gewesen.", a: "wÃ¤re", topic: "Inversion" }
  ]
};

const levels = ["B1", "B2", "C1"];

function generateLesson() {
  const level = levels[Math.floor(Math.random() * levels.length)];
  const pool = grammarPool[level];
  const item = pool[Math.floor(Math.random() * pool.length)];

  return {
    type: "short",
    level,
    topic: item.topic,
    question: item.q,
    answer: item.a
  };
}


let stats = JSON.parse(localStorage.getItem("stats")) || {
  total:0, correct:0, lastDate:null, streak:0
};

function today() {
  return new Date().toISOString().split("T")[0];
}

function updateStreak() {
  const t = today();
  if (stats.lastDate === t) return;
  stats.streak = (stats.lastDate === new Date(Date.now()-86400000).toISOString().split("T")[0])
    ? stats.streak+1 : 1;
  stats.lastDate = t;
}

function saveStats() {
  localStorage.setItem("stats", JSON.stringify(stats));
  renderStats();
}

function renderStats() {
  const pct = stats.total ? Math.round(stats.correct/stats.total*100) : 0;
  progressBar.style.width = pct+"%";
  statsEl.innerText = `Correct ${stats.correct}/${stats.total}`;
  streak.innerText = `ðŸ”¥ Streak: ${stats.streak} days`;
}

const progressBar = document.getElementById("progressBar");
const statsEl = document.getElementById("stats");
const streak = document.getElementById("streak");

function renderLesson() {
  const box = document.getElementById("lessonBox");
  box.classList.remove("animate");
  void box.offsetWidth; // FORCE reflow
  box.classList.add("animate");

const l = currentLesson;

  if (l.type === "short") {
    box.innerHTML = `
      <h3>${l.level} â€“ ${l.topic}</h3>
      <p>${l.question}</p>
      <input id="answer" onkeydown="if(event.key==='Enter')checkShort()">
      <br>
      <button onclick="checkShort()">Check</button>
      <p id="feedback"></p>
      <button onclick="nextLesson()">Next</button>
    `;
  } else {
    box.innerHTML = `
      <h3>${l.level} â€“ ${l.topic}</h3>
      <p>${l.text}</p>
      ${l.questions.map((q,i)=>`
        <p>${q.q}<br><input id="q${i}"></p>
      `).join("")}
      <button onclick="checkDeep()">Check</button>
      <p id="feedback"></p>
      <button onclick="nextLesson()">Next</button>
    `;
  }
}

function checkShort() {
  updateStreak();
  stats.total++;
  const user = answer.value.trim();
  const fb = feedback;
  if (user === lessons[index].answer) {
    stats.correct++;
    fb.innerHTML = "âœ” Correct!";
    fb.style.color="green";
  } else {
    fb.innerHTML = `âœ˜ Correct: <b>${lessons[index].answer}</b>`;
    fb.style.color="red";
  }
  saveStats();
}

function checkDeep() {
  updateStreak();
  let score=0;
  lessons[index].questions.forEach((q,i)=>{
    if (document.getElementById("q"+i).value.toLowerCase().includes(q.a.toLowerCase()))
      score++;
  });
  stats.total += lessons[index].questions.length;
  stats.correct += score;
  feedback.innerHTML = `Score: ${score}/${lessons[index].questions.length}`;
  saveStats();
}

function nextLesson() {
  currentLesson = generateLesson();
  renderLesson();
}
let currentLesson = generateLesson();
  
function toggleDark() {
  document.body.classList.toggle("dark");
  localStorage.setItem("dark", document.body.classList.contains("dark"));
}

if (localStorage.getItem("dark")==="true") document.body.classList.add("dark");

renderStats();
renderLesson();
</script>

</body>
</html>
